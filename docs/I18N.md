# ParVu Internationalization (i18n) Guide

## Overview

ParVu now supports multiple languages with an easy-to-use internationalization system. The application currently includes:

- üá¨üáß **English** (en)
- üá∑üá∫ **Russian** (ru) - –†—É—Å—Å–∫–∏–π
- üá¶üáø **Azerbaijani** (az) - Az…ôrbaycan

## Features

- **Easy language switching** - Change language in Settings dialog
- **Flag icons** - Visual language identification with emoji flags
- **Complete coverage** - All UI text is translatable
- **Format support** - Dynamic text formatting with variables
- **Extensible** - Add new languages easily

## Using i18n in Code

### Basic Usage

```python
from i18n import t

# Simple translation
window_title = t("app.title")  # "ParVu - Parquet/CSV Viewer"

# Translation with formatting
status = t("status.loaded", filename="data.parquet", rows=1000)
# "Loaded: data.parquet (1,000 rows)"

# Error messages
error = t("error.file_not_found_msg", path="/path/to/file")
# "File does not exist: /path/to/file"
```

### In Qt Widgets

```python
from i18n import t

# Window titles
self.setWindowTitle(t("app.title"))

# Button labels
self.browse_btn = QPushButton(t("btn.browse"))
self.save_btn = QPushButton(t("btn.save"))
self.cancel_btn = QPushButton(t("btn.cancel"))

# Menu items
file_menu = menubar.addMenu(t("menu.file"))
open_action = file_menu.addAction(t("menu.file.open"))

# Labels
self.label = QLabel(t("settings.label.table_var"))

# Status messages
self.statusBar().showMessage(t("status.ready"))

# Dialog messages
QMessageBox.warning(
    self,
    t("error.no_file"),
    t("error.no_file_msg")
)
```

### Changing Language at Runtime

```python
from i18n import get_i18n
from schemas import settings

# Get i18n instance
i18n = get_i18n()

# Change language
i18n.set_locale("ru")  # Switch to Russian

# Save to settings
settings.current_language = "ru"
settings.save_settings()

# Refresh UI (requires restart or manual update)
self.refresh_ui()
```

## Translation Keys

All translation keys are organized hierarchically:

### Application
- `app.name` - Application name
- `app.title` - Window title
- `app.ready` - Ready status
- `app.loading` - Loading status

### Menus
- `menu.file` - File menu
- `menu.file.open` - Open File action
- `menu.file.export` - Export Results
- `menu.file.settings` - Settings
- `menu.file.change_theme` - Change Theme
- `menu.file.recent_files` - Recent Files
- `menu.file.exit` - Exit
- `menu.help` - Help menu
- `menu.help.about` - About ParVu

### Buttons
- `btn.browse` - Browse & Load
- `btn.reload` - Reload from Path
- `btn.execute` - Execute Query
- `btn.reset` - Reset Query
- `btn.save` - Save
- `btn.cancel` - Cancel
- `btn.apply` - Apply
- `btn.import` - Import
- `btn.export` - Export
- `btn.delete` - Delete

### Labels
- `label.file_placeholder` - File selection placeholder
- `label.sql_query` - SQL Query label (with {table_name})
- `label.results` - Results label
- `label.page` - Page label
- `label.search_placeholder` - Search placeholder

### Status Messages
- `status.ready` - Ready
- `status.loading` - Loading...
- `status.page_info` - Page info (with {page}, {total_pages})
- `status.loaded` - File loaded (with {filename}, {rows})
- `status.sorted` - Sorted by (with {column}, {direction})

### Dialogs
- `dialog.open_file` - Open File dialog
- `dialog.table_info` - Table Information
- `dialog.about` - About ParVu
- `dialog.settings` - Settings
- `dialog.theme_selector` - Theme Selector
- `dialog.unique_values` - Unique Values (with {column_name})

### Errors
- `error.no_file` - No File error title
- `error.no_file_msg` - No File error message
- `error.file_not_found` - File Not Found title
- `error.file_not_found_msg` - File Not Found message (with {path})
- `error.query_error` - Query Error title
- `error.query_error_msg` - Query Error message (with {error_msg})
- `error.empty_query` - Empty Query title

### Warnings
- `warning.no_data` - No Data warning
- `warning.large_dataset` - Large Dataset Warning
- `warning.large_dataset_rows` - Row count warning (with {rows}, {threshold})
- `warning.large_dataset_cells` - Cell count warning (with {cells}, {rows}, {columns}, {threshold})
- `warning.large_dataset_size` - File size warning (with {size}, {threshold})

### Settings
- `settings.tab.general` - General tab
- `settings.tab.theme` - Theme tab
- `settings.tab.advanced` - Advanced tab
- `settings.tab.warnings` - Warnings tab
- `settings.label.table_var` - Table Variable Name
- `settings.label.rows_per_page` - Rows Per Page
- `settings.label.active_theme` - Active Theme
- `settings.tooltip.*` - Various tooltips

### Context Menu
- `context.copy_column` - Copy Column Name
- `context.sort_asc` - Sort Ascending
- `context.sort_desc` - Sort Descending
- `context.copy_values` - Copy Values as Tuple
- `context.unique_values` - Show Unique Values

### Language Settings
- `language.name` - Language:
- `language.label` - Interface Language:

## Adding a New Language

### 1. Create Translation Dictionary

Edit `src/i18n.py` and add a new translations dictionary:

```python
TRANSLATIONS_FR = {
    "app.name": "ParVu",
    "app.title": "ParVu - Visualiseur Parquet/CSV",
    "menu.file": "Fichier",
    "menu.file.open": "Ouvrir un fichier...",
    # ... add all translation keys
}
```

### 2. Register Locale

In the `I18n._initialize_locales()` method:

```python
# French
fr = Locale("fr", "French", "Fran√ßais", "üá´üá∑")
fr.translations = TRANSLATIONS_FR
self.locales["fr"] = fr
```

### 3. Test Translation

```python
from i18n import get_i18n

i18n = get_i18n()
i18n.set_locale("fr")
print(i18n.t("menu.file"))  # Should print "Fichier"
```

## Migration Guide

### Converting Hardcoded Strings

**Before:**
```python
self.setWindowTitle("ParVu - Parquet/CSV Viewer")
self.browse_btn = QPushButton("Browse & Load...")
QMessageBox.warning(self, "Error", "File not found")
```

**After:**
```python
from i18n import t

self.setWindowTitle(t("app.title"))
self.browse_btn = QPushButton(t("btn.browse"))
QMessageBox.warning(self, t("error.file_not_found"), t("error.file_not_found_msg", path=file_path))
```

### Dynamic Text Updates

When language changes, you need to update all text:

```python
def update_ui_language(self):
    """Update all UI text to current language"""
    from i18n import t

    # Update window title
    self.setWindowTitle(t("app.title"))

    # Update buttons
    self.browse_btn.setText(t("btn.browse"))
    self.save_btn.setText(t("btn.save"))

    # Update labels
    self.results_label.setText(t("label.results"))

    # Update menu items
    self.file_menu.setTitle(t("menu.file"))
    self.open_action.setText(t("menu.file.open"))
```

## Language Selector Widget

A language selector widget is provided in `src/language_selector.py`:

```python
from language_selector import LanguageSelector

# In settings dialog
lang_selector = LanguageSelector()
lang_selector.language_changed.connect(self.on_language_changed)
layout.addWidget(lang_selector)

def on_language_changed(self, locale_code):
    # Update settings
    settings.current_language = locale_code
    settings.save_settings()

    # Notify user to restart
    QMessageBox.information(
        self,
        "Language Changed",
        "Please restart ParVu for the language change to take effect."
    )
```

## Best Practices

### 1. Always Use Translation Keys
Never hardcode user-facing text. Always use translation keys.

**Bad:**
```python
button = QPushButton("Click Me")
```

**Good:**
```python
from i18n import t
button = QPushButton(t("btn.click_me"))
```

### 2. Keep Keys Organized
Use hierarchical naming:
- `menu.file.open` - Menu ‚Üí File ‚Üí Open
- `settings.label.theme` - Settings ‚Üí Label ‚Üí Theme
- `error.query_error_msg` - Error ‚Üí Query Error ‚Üí Message

### 3. Provide Context in Formatting
When using variables, make them descriptive:

**Bad:**
```python
t("message", a=10, b=20)
```

**Good:**
```python
t("status.loaded", filename="data.csv", rows=1000)
```

### 4. Test All Languages
Always test your changes in all supported languages to ensure:
- Text fits in UI elements
- Formatting works correctly
- No missing translations

### 5. Add Comments for Translators
In translation dictionaries, add comments for context:

```python
# File operations
"menu.file.open": "Open File...",  # Dialog title for opening files
"menu.file.export": "Export Results...",  # Save query results to file

# Status messages (shown in status bar)
"status.ready": "Ready",
"status.loading": "Loading...",
```

## Translation Coverage

| Component | Status | Keys |
|-----------|--------|------|
| Main Window | ‚úÖ Complete | 40+ |
| Settings Dialog | ‚úÖ Complete | 50+ |
| Theme Selector | ‚úÖ Complete | 15+ |
| Table View | ‚úÖ Complete | 10+ |
| SQL Editor | N/A | Syntax only |
| Context Menus | ‚úÖ Complete | 5+ |
| Error Messages | ‚úÖ Complete | 15+ |

**Total Translation Keys: 180+**

## Supported Languages

| Language | Code | Native Name | Flag | Status |
|----------|------|-------------|------|--------|
| English | en | English | üá¨üáß | ‚úÖ Complete |
| Russian | ru | –†—É—Å—Å–∫–∏–π | üá∑üá∫ | ‚úÖ Complete |
| Azerbaijani | az | Az…ôrbaycan | üá¶üáø | ‚úÖ Complete |

## Future Enhancements

- [ ] Real-time language switching (without restart)
- [ ] Automatic language detection from system locale
- [ ] Translation export/import for community contributions
- [ ] Right-to-left (RTL) language support
- [ ] Pluralization support (1 file vs 2 files)
- [ ] Date/time formatting per locale

## Troubleshooting

### Missing Translation

If a key is missing, the key itself is returned:

```python
t("missing.key")  # Returns "missing.key"
```

Check the log for warnings:
```
WARNING: Translation key not found: missing.key
```

### Formatting Errors

If formatting fails, the unformatted string is returned:

```python
t("status.loaded", wrong_param=10)  # May fail if {filename} and {rows} are required
```

Check logs for formatting errors.

### Language Not Changing

1. Verify locale code is correct: `en`, `ru`, or `az`
2. Check that settings are saved: `settings.save_settings()`
3. Restart the application
4. Check logs for language initialization

## Contributing Translations

To contribute a new language translation:

1. Fork the repository
2. Copy `TRANSLATIONS_EN` dictionary in `src/i18n.py`
3. Translate all keys to your language
4. Add locale registration in `_initialize_locales()`
5. Test thoroughly
6. Submit a pull request

Include:
- Language name in English and native script
- ISO 639-1 language code
- Flag emoji
- Sample screenshots

## Example Implementation

See the complete implementation in:
- `src/i18n.py` - Core i18n system
- `src/language_selector.py` - Language selector widget
- `src/app.py` - Initialization
- `src/schemas.py` - Settings integration

For questions or issues, please open an issue on GitHub.

---

Happy translating! üåç
